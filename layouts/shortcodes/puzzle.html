{{- $type := .Get "type" -}}
{{- $inner := .Inner -}}

{{- if findRE "^\\s*<!--" $inner -}}
  {{- $inner = $inner | replaceRE "^\\s*<!--\\s*" "" -}}
  {{- $inner = $inner | replaceRE "\\s*-->\\s*$" "" -}}
{{- end -}}

{{- if eq $type "plain" -}}
  {{- $inner | plainify -}}
{{- else if eq $type "subtle" -}}
<span class="is-a-puzzle" style="display: none; align-items: baseline;" data-should-display="inline-flex">
  <span style="vertical-align: middle;">{{- .Inner | markdownify | chomp -}}</span>
  <img src="/images/puzzle-logo.png" alt="Puzzle Logo" style="height: 1.2em; width: auto; margin-left: 0.25em; vertical-align: middle;">
</span>
{{- else -}}
<div class="is-a-puzzle" style="display: none;" data-should-display="{{ if eq $type "true" }}block{{ else }}flex{{ end }}">
  <div style="width: 100%; margin: 1rem auto;">
    {{- if eq $type "text" -}}
      <div style="font-size: 1.1rem;">
        {{- $inner | markdownify -}}
      </div>
    {{- else -}}
      <div style="
        display: flex;
        align-items: flex-start;
        border: 2px solid #002b36;
        border-radius: 16px;
        padding: 1rem;
        background-color: #fdfdfd;
      ">
        <div style="flex-shrink: 0; margin-right: 1rem;">
          <img src="/images/puzzle-logo.png" alt="Puzzle Logo" style="width: 60px; height: 60px; border-radius: 12px;">
        </div>
        <div style="font-size: 1.1rem; flex-grow: 1;">
          {{- $inner | markdownify -}}
        </div>
      </div>
    {{- end -}}
  </div>
</div>
{{- end -}}

